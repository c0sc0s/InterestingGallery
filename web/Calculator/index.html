<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>无用计算器 | The Useless Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Noto+Serif+SC:wght@500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body
    id="body"
    class="h-screen w-full flex items-center justify-center bg-neutral-900 selection:bg-orange-500 selection:text-white"
  >
    <!-- 粒子容器 -->
    <div id="particle-container"></div>

    <!-- 计算器外壳 -->
    <div
      id="calculator"
      class="w-full max-w-sm bg-black rounded-[2rem] p-5 shadow-2xl border border-neutral-800 relative transition-all duration-700 ease-in-out"
    >
      <!-- 装饰性光泽 -->
      <div
        class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-neutral-700 to-transparent opacity-50"
      ></div>

      <!-- 显示屏区域 -->
      <div
        class="h-48 mb-4 flex flex-col justify-end items-end p-2 text-right relative z-20"
      >
        <!-- 小字：运算过程 (伪装) -->
        <div
          id="history"
          class="text-neutral-500 text-lg mb-1 h-6 w-full truncate transition-opacity duration-300"
        ></div>

        <!-- 大字：主显示/答案 -->
        <div
          id="display"
          data-text="0"
          class="text-white text-5xl font-light break-words w-full screen-glow transition-all duration-300 max-h-32 overflow-y-auto no-scrollbar flex items-end justify-end"
        >
          0
        </div>
      </div>

      <!-- 键盘区域 -->
      <div id="keypad" class="grid grid-cols-4 gap-3 relative z-10">
        <!-- Row 1 -->
        <button
          id="btn-ac"
          class="calc-btn h-16 w-16 rounded-full bg-neutral-400 text-black text-2xl font-bold hover:bg-neutral-300 flex items-center justify-center"
        >
          AC
        </button>
        <button
          id="btn-sign"
          class="calc-btn h-16 w-16 rounded-full bg-neutral-400 text-black text-2xl font-bold hover:bg-neutral-300 flex items-center justify-center"
        >
          +/-
        </button>
        <button
          id="btn-percent"
          class="calc-btn h-16 w-16 rounded-full bg-neutral-400 text-black text-2xl font-bold hover:bg-neutral-300 flex items-center justify-center"
        >
          %
        </button>
        <button
          id="btn-divide"
          class="calc-btn h-16 w-16 rounded-full bg-orange-500 text-white text-3xl font-bold hover:bg-orange-400 flex items-center justify-center pb-1"
        >
          ÷
        </button>

        <!-- Row 2 -->
        <button
          id="btn-7"
          class="calc-btn h-16 w-16 rounded-full bg-neutral-800 text-white text-3xl hover:bg-neutral-700 flex items-center justify-center"
        >
          7
        </button>
        <button
          id="btn-8"
          class="calc-btn h-16 w-16 rounded-full bg-neutral-800 text-white text-3xl hover:bg-neutral-700 flex items-center justify-center"
        >
          8
        </button>
        <button
          id="btn-9"
          class="calc-btn h-16 w-16 rounded-full bg-neutral-800 text-white text-3xl hover:bg-neutral-700 flex items-center justify-center"
        >
          9
        </button>
        <button
          id="btn-multiply"
          class="calc-btn h-16 w-16 rounded-full bg-orange-500 text-white text-3xl font-bold hover:bg-orange-400 flex items-center justify-center pb-1"
        >
          ×
        </button>

        <!-- Row 3 -->
        <button
          id="btn-4"
          class="calc-btn h-16 w-16 rounded-full bg-neutral-800 text-white text-3xl hover:bg-neutral-700 flex items-center justify-center"
        >
          4
        </button>
        <button
          id="btn-5"
          class="calc-btn h-16 w-16 rounded-full bg-neutral-800 text-white text-3xl hover:bg-neutral-700 flex items-center justify-center"
        >
          5
        </button>
        <button
          id="btn-6"
          class="calc-btn h-16 w-16 rounded-full bg-neutral-800 text-white text-3xl hover:bg-neutral-700 flex items-center justify-center"
        >
          6
        </button>
        <button
          id="btn-subtract"
          class="calc-btn h-16 w-16 rounded-full bg-orange-500 text-white text-3xl font-bold hover:bg-orange-400 flex items-center justify-center pb-1"
        >
          -
        </button>

        <!-- Row 4 -->
        <button
          id="btn-1"
          class="calc-btn h-16 w-16 rounded-full bg-neutral-800 text-white text-3xl hover:bg-neutral-700 flex items-center justify-center"
        >
          1
        </button>
        <button
          id="btn-2"
          class="calc-btn h-16 w-16 rounded-full bg-neutral-800 text-white text-3xl hover:bg-neutral-700 flex items-center justify-center"
        >
          2
        </button>
        <button
          id="btn-3"
          class="calc-btn h-16 w-16 rounded-full bg-neutral-800 text-white text-3xl hover:bg-neutral-700 flex items-center justify-center"
        >
          3
        </button>
        <button
          id="btn-add"
          class="calc-btn h-16 w-16 rounded-full bg-orange-500 text-white text-3xl font-bold hover:bg-orange-400 flex items-center justify-center pb-1"
        >
          +
        </button>

        <!-- Row 5 -->
        <button
          id="btn-0"
          class="calc-btn h-16 w-[10.5rem] rounded-full bg-neutral-800 text-white text-3xl hover:bg-neutral-700 pl-7 flex items-center justify-start col-span-2"
        >
          0
        </button>
        <button
          id="btn-dot"
          class="calc-btn h-16 w-16 rounded-full bg-neutral-800 text-white text-3xl hover:bg-neutral-700 flex items-center justify-center"
        >
          .
        </button>
        <button
          id="btn-equal"
          class="calc-btn h-16 w-16 rounded-full bg-orange-500 text-white text-3xl font-bold hover:bg-white hover:text-orange-500 transition-colors duration-300 flex items-center justify-center pb-1"
        >
          =
        </button>
      </div>

      <!-- 底部标语 -->
      <div
        class="text-center mt-6 text-neutral-700 text-xs tracking-widest uppercase opacity-40"
      >
        Instrumental Rationality is Dead
      </div>
    </div>

    <script type="module">
      import { Calculator } from "./modules/calculator.js";
      import { initAudio } from "./modules/audio.js";
      import { initRunawayButton } from "./modules/effects.js";

      // 初始化音频系统
      initAudio();

      // 获取DOM元素
      const display = document.getElementById("display");
      const history = document.getElementById("history");
      const calculator = document.getElementById("calculator");
      const body = document.getElementById("body");
      const buttons = document.querySelectorAll(".calc-btn");

      // 创建计算器实例
      const calc = new Calculator(display, history, calculator, body, buttons);

      // 初始化逃跑的等于号
      const equalBtn = document.getElementById("btn-equal");
      if (equalBtn) {
        initRunawayButton(equalBtn);
      }

      // 绑定按钮事件
      document
        .getElementById("btn-ac")
        .addEventListener("click", () => calc.clearDisplay());
      document
        .getElementById("btn-sign")
        .addEventListener("click", () => calc.appendSymbol("±"));
      document
        .getElementById("btn-percent")
        .addEventListener("click", () => calc.appendSymbol("%"));
      document
        .getElementById("btn-divide")
        .addEventListener("click", () => calc.appendOperator("÷"));
      document
        .getElementById("btn-multiply")
        .addEventListener("click", () => calc.appendOperator("×"));
      document
        .getElementById("btn-subtract")
        .addEventListener("click", () => calc.appendOperator("-"));
      document
        .getElementById("btn-add")
        .addEventListener("click", () => calc.appendOperator("+"));
      document
        .getElementById("btn-equal")
        .addEventListener("click", () => calc.calculateUselessly());

      // 数字按钮
      for (let i = 0; i <= 9; i++) {
        const btn = document.getElementById(`btn-${i}`);
        if (btn) {
          btn.addEventListener("click", () => calc.appendNumber(i.toString()));
        }
      }

      document
        .getElementById("btn-dot")
        .addEventListener("click", () => calc.appendNumber("."));

      // 将计算器实例暴露到全局，方便调试
      window.calc = calc;
    </script>
  </body>
</html>
